# å¦‚ä½•æ’°å¯«æ–‡ç« 

å®Œæ•´æŒ‡å—ï¼šå¾å‰µå»ºæ–‡ç« åˆ°ä¸Šå‚³åœ–ç‰‡åˆ° R2

---

## å¿«é€Ÿé–‹å§‹

### 1. å‰µå»ºæ–°æ–‡ç« 

åœ¨ `content/` ç›®éŒ„ä¸‹æŒ‰ç…§å¹´ä»½/æœˆä»½å‰µå»º `.md` æ–‡ä»¶ï¼š

```bash
# ç¯„ä¾‹ï¼šå‰µå»º 2025 å¹´ 11 æœˆçš„æ–‡ç« 
content/2025/11/my-new-post.md
```

**ç›®éŒ„çµæ§‹ï¼š**
```
content/
â”œâ”€â”€ 2025/
â”‚   â”œâ”€â”€ 11/
â”‚   â”‚   â”œâ”€â”€ my-new-post.md
â”‚   â”‚   â””â”€â”€ another-post.md
â”‚   â””â”€â”€ 10/
â”‚       â””â”€â”€ old-post.md
```

### 2. æ–‡ç«  Frontmatterï¼ˆå¿…å¡«ï¼‰

æ¯ç¯‡æ–‡ç« é–‹é ­å¿…é ˆåŒ…å« frontmatterï¼ˆYAML æ ¼å¼ï¼‰ï¼š

```markdown
---
title: "æ–‡ç« æ¨™é¡Œ"
date: 2025-11-01
tags:
  - æ¨™ç±¤1
  - æ¨™ç±¤2
categories:
  - åˆ†é¡åç¨±
---
```

**Frontmatter æ¬„ä½èªªæ˜ï¼š**

| æ¬„ä½ | å¿…å¡« | èªªæ˜ | ç¯„ä¾‹ |
|------|------|------|------|
| `title` | âœ… | æ–‡ç« æ¨™é¡Œ | `"æˆ‘çš„ç¬¬ä¸€ç¯‡æ–‡ç« "` |
| `date` | âœ… | ç™¼å¸ƒæ—¥æœŸ | `2025-11-01` æˆ– `Fri Nov 01 2025 12:00:00 GMT+0800` |
| `tags` | âŒ | æ¨™ç±¤åˆ—è¡¨ï¼ˆé™£åˆ—ï¼‰ | `["æŠ€è¡“", "Next.js"]` |
| `categories` | âœ… | åˆ†é¡ï¼ˆé™£åˆ—ï¼Œç¬¬ä¸€å€‹ç‚ºä¸»åˆ†é¡ï¼‰ | `["æŠ€è¡“ç­†è¨˜"]` |
| `coverImage` | âŒ | å°é¢åœ–ç‰‡**æª”å**æˆ–å®Œæ•´ URL | `"cover.webp"` æˆ–å®Œæ•´ URL |

**âš ï¸ é‡è¦ï¼š**
- å¦‚æœæ²’æœ‰è¨­å®š `coverImage`ï¼Œç³»çµ±æœƒ**è‡ªå‹•æå–æ–‡ç« ä¸­çš„ç¬¬ä¸€å¼µåœ–ç‰‡**ä½œç‚ºå°é¢
- æ–‡ç« æª”åæœƒè‡ªå‹•æˆç‚º URL slugï¼ˆä¸å« `.md` å‰¯æª”åï¼‰

---

## åœ–ç‰‡è™•ç†

### åœ–ç‰‡è·¯å¾‘è¦å‰‡

ä½ çš„ R2 bucket çµæ§‹ï¼š
```
blog-post/           â† R2 bucket åç¨±
â”œâ”€â”€ 2025/
â”‚   â”œâ”€â”€ 11/
â”‚   â”‚   â””â”€â”€ my-new-post/
â”‚   â”‚       â”œâ”€â”€ image1.webp
â”‚   â”‚       â””â”€â”€ image2.jpg
â”‚   â””â”€â”€ 10/
â”‚       â””â”€â”€ old-post/
â”‚           â””â”€â”€ photo.png
```

**å…¬é–‹è¨ªå• URL æ ¼å¼ï¼š**
```
https://your-cdn-domain.com/{year}/{month}/{slug}/{filename}
```

**ç¯„ä¾‹ï¼š**
```
https://your-cdn-domain.com/2025/11/my-new-post/image1.webp
```

âš ï¸ **æ³¨æ„ï¼šURL ä¸­ä¸åŒ…å« `blog-post` å‰ç¶´**ï¼ˆå› ç‚ºå®ƒæ˜¯ bucket åç¨±ï¼Œå·²ç¶“åœ¨ Cloudflare é…ç½®ä¸­ç¶å®šåˆ°åŸŸåï¼‰

### æ–¹æ³• 1ï¼šç›´æ¥åœ¨æ–‡ç« ä¸­ä½¿ç”¨å®Œæ•´ URLï¼ˆæ¨è–¦ï¼‰

```markdown
---
title: "æˆ‘çš„æ–°æ–‡ç« "
date: 2025-11-01
categories:
  - æŠ€è¡“ç­†è¨˜
coverImage: "https://your-cdn-domain.com/2025/11/my-new-post/cover.webp"
---

é€™æ˜¯æ–‡ç« å…§å®¹ã€‚

![åœ–ç‰‡æè¿°](https://your-cdn-domain.com/2025/11/my-new-post/image1.webp)

æ›´å¤šæ–‡å­—...

![å¦ä¸€å¼µåœ–](https://your-cdn-domain.com/2025/11/my-new-post/image2.jpg)
```

**å„ªé»ï¼š**
- âœ… æ˜ç¢ºã€ä¸æœƒå‡ºéŒ¯
- âœ… æ”¯æ´ä»»ä½•åœ–åºŠï¼ˆä¸é™ R2ï¼‰
- âœ… ä¸éœ€è¦é¡å¤–è™•ç†

### æ–¹æ³• 2ï¼šä½¿ç”¨ç›¸å°è·¯å¾‘ï¼ˆéœ€è¦å¾ŒçºŒè™•ç†ï¼‰

```markdown
---
title: "æˆ‘çš„æ–°æ–‡ç« "
date: 2025-11-01
categories:
  - æŠ€è¡“ç­†è¨˜
coverImage: "cover.webp"
---

æ–‡ç« å…§å®¹...

![åœ–ç‰‡æè¿°](images/image1.webp)
![å¦ä¸€å¼µåœ–](images/image2.jpg)
```

**å¾ŒçºŒéœ€è¦ï¼š**
1. å°‡åœ–ç‰‡ä¸Šå‚³åˆ° R2
2. é‹è¡Œ `npm run images:update` æ›´æ–°è·¯å¾‘

---

## åœ–ç‰‡ä¸Šå‚³åˆ° R2

### å‰ç½®ä½œæ¥­ï¼šé…ç½® rclone

**1. å®‰è£ rclone**

```bash
# macOS
brew install rclone

# æˆ–å¾å®˜ç¶²ä¸‹è¼‰
https://rclone.org/install/
```

**2. é…ç½® R2 é ç«¯**

```bash
rclone config
```

æŒ‰ç…§æç¤ºæ“ä½œï¼š
- **Name**: `r2`
- **Storage**: `s3` (é¸æ“‡ Amazon S3 Compliant)
- **Provider**: `Cloudflare`
- **Access Key ID**: å¾ Cloudflare R2 API Token ç²å–
- **Secret Access Key**: å¾ Cloudflare R2 API Token ç²å–
- **Region**: `auto`
- **Endpoint**: `https://{ä½ çš„AccountID}.r2.cloudflarestorage.com`

**3. å‰µå»º `.env` æª”æ¡ˆ**

è¤‡è£½ `.env.example` ä¸¦å¡«å…¥å¯¦éš›å€¼ï¼š

```bash
cp .env.example .env
```

ç·¨è¼¯ `.env`ï¼š
```env
CF_ACCOUNT_ID=ä½ çš„å¸³è™ŸID
R2_BUCKET=blog-post
R2_BASE_URL=https://your-cdn-domain.com
R2_PREFIX=blog-post  # é€™æ˜¯ bucket åç¨±ï¼Œä¸å½±éŸ¿ URL
RCLONE_REMOTE=r2
```

### ä¸Šå‚³åœ–ç‰‡æµç¨‹

å‡è¨­ä½ æœ‰ä¸€ç¯‡æ–‡ç« ï¼š`content/2025/11/my-new-post.md`

**æº–å‚™åœ–ç‰‡ï¼š**

æœ¬åœ°æº–å‚™å¥½åœ–ç‰‡æ–‡ä»¶ï¼ˆä»»æ„ä½ç½®ï¼‰ï¼Œä¾‹å¦‚ï¼š
```
~/Downloads/
â”œâ”€â”€ cover.webp
â”œâ”€â”€ screenshot1.png
â””â”€â”€ photo.jpg
```

**ä¸Šå‚³åˆ° R2ï¼š**

ä½¿ç”¨ rclone æ‰‹å‹•ä¸Šå‚³åˆ°å°æ‡‰è·¯å¾‘ï¼š

```bash
# èªæ³•
rclone copy {æœ¬åœ°ç›®éŒ„} r2:blog-post/{year}/{month}/{slug}/

# ç¯„ä¾‹
rclone copy ~/Downloads/ r2:blog-post/2025/11/my-new-post/ \
  --include "*.{jpg,jpeg,png,webp,gif}" \
  --progress
```

**é©—è­‰ä¸Šå‚³ï¼š**

```bash
# åˆ—å‡º R2 ä¸Šçš„æª”æ¡ˆ
rclone ls r2:blog-post/2025/11/my-new-post/

# è¼¸å‡ºæ‡‰è©²é¡¯ç¤ºï¼š
#    153746 cover.webp
#     67022 screenshot1.png
#    223891 photo.jpg
```

**åœ¨æ–‡ç« ä¸­å¼•ç”¨ï¼š**

```markdown
![å°é¢](https://your-cdn-domain.com/2025/11/my-new-post/cover.webp)
![æˆªåœ–](https://your-cdn-domain.com/2025/11/my-new-post/screenshot1.png)
![ç…§ç‰‡](https://your-cdn-domain.com/2025/11/my-new-post/photo.jpg)
```

---

## å®Œæ•´ç¯„ä¾‹

### ç¯„ä¾‹æ–‡ç« ï¼š`content/2025/11/nextjs-tutorial.md`

```markdown
---
title: "Next.js 15 å®Œæ•´æ•™å­¸"
date: 2025-11-01
tags:
  - Next.js
  - React
  - æ•™å­¸
categories:
  - æŠ€è¡“ç­†è¨˜
coverImage: "https://your-cdn-domain.com/2025/11/nextjs-tutorial/cover.webp"
---

## ä»€éº¼æ˜¯ Next.jsï¼Ÿ

Next.js æ˜¯ä¸€å€‹åŸºæ–¼ React çš„å…¨ç«¯æ¡†æ¶...

![Next.js Logo](https://your-cdn-domain.com/2025/11/nextjs-tutorial/nextjs-logo.png)

## å®‰è£èˆ‡è¨­å®š

é¦–å…ˆå®‰è£ Next.jsï¼š

\```bash
npx create-next-app@latest
\```

![å®‰è£éç¨‹](https://your-cdn-domain.com/2025/11/nextjs-tutorial/installation.webp)

## ç¸½çµ

é€™ç¯‡æ–‡ç« ä»‹ç´¹äº† Next.js çš„åŸºç¤æ¦‚å¿µ...
```

### å°æ‡‰çš„ R2 çµæ§‹

```
blog-post/
â””â”€â”€ 2025/
    â””â”€â”€ 11/
        â””â”€â”€ nextjs-tutorial/
            â”œâ”€â”€ cover.webp
            â”œâ”€â”€ nextjs-logo.png
            â””â”€â”€ installation.webp
```

### ä¸Šå‚³æŒ‡ä»¤

```bash
# å‡è¨­åœ–ç‰‡åœ¨ ~/Desktop/nextjs-images/
rclone copy ~/Desktop/nextjs-images/ \
  r2:blog-post/2025/11/nextjs-tutorial/ \
  --include "*.{jpg,jpeg,png,webp,gif}" \
  --progress
```

---

## å¸¸è¦‹åˆ†é¡

ç³»çµ±é è¨­çš„åˆ†é¡åŠå…¶å°æ‡‰é¡è‰²ï¼š

| åˆ†é¡ | é¡è‰² |
|------|------|
| å°å¤§è³‡ç®¡ç”Ÿæ´» | è—è‰² |
| ç§‘å­¸ç­ç”Ÿæ´» | ç´«è‰² |
| æ”å½±ç­†è¨˜ | ç¶ è‰² |
| åŸå¸‚æ¼«æ­¥ | é»ƒè‰² |
| ç”Ÿæ´»æ—¥èªŒ | ç²‰ç´…è‰² |
| è®€æ›¸ç­†è¨˜èˆ‡å¿ƒå¾— | é›è—è‰² |
| æŠ€è¡“ç­†è¨˜ | ç´…è‰² |

---

## æ¸¬è©¦èˆ‡é©—è­‰

### æœ¬åœ°æ¸¬è©¦

```bash
# å•Ÿå‹•é–‹ç™¼ä¼ºæœå™¨
npm run dev

# è¨ªå•æ–‡ç« 
http://localhost:3000/blog/2025/11/nextjs-tutorial
```

### é©—è­‰åœ–ç‰‡

```bash
# æ¸¬è©¦åœ–ç‰‡ URL æ˜¯å¦å¯è¨ªå•
curl -I "https://your-cdn-domain.com/2025/11/nextjs-tutorial/cover.webp"

# æ‡‰è©²è¿”å› HTTP/2 200
```

### å¸¸è¦‹å•é¡Œæ’æŸ¥

**1. åœ–ç‰‡é¡¯ç¤º 404**
- âœ… æª¢æŸ¥ R2 ä¸Šæ˜¯å¦æœ‰è©²æª”æ¡ˆï¼š`rclone ls r2:blog-post/2025/11/nextjs-tutorial/`
- âœ… æª¢æŸ¥ URL æ ¼å¼æ˜¯å¦æ­£ç¢ºï¼ˆä¸è¦åŒ…å« `/blog-post/` å‰ç¶´ï¼‰
- âœ… ç¢ºèª Cloudflare R2 å·²å•Ÿç”¨ Public Access

**2. åœ–ç‰‡é¡¯ç¤º 403**
- âœ… å‰å¾€ Cloudflare Dashboard > R2 > ä½ çš„ bucket > Settings
- âœ… å•Ÿç”¨ "Public Access"
- âœ… ç¢ºèªè‡ªå®šç¾©åŸŸå `your-cdn-domain.com` å·²æ­£ç¢ºç¶å®š

**3. å°é¢åœ–ç‰‡æ²’æœ‰é¡¯ç¤º**
- âœ… æª¢æŸ¥ frontmatter ä¸­çš„ `coverImage` æ˜¯å¦æ­£ç¢º
- âœ… å¦‚æœæ²’è¨­å®šï¼Œç¢ºèªæ–‡ç« ä¸­è‡³å°‘æœ‰ä¸€å¼µåœ–ç‰‡ï¼ˆç³»çµ±æœƒè‡ªå‹•æå–ï¼‰

---

## å¿«é€Ÿæª¢æŸ¥æ¸…å–®

æ’°å¯«æ–°æ–‡ç« å‰ï¼š

- [ ] ç¢ºèªæ–‡ç« è·¯å¾‘ï¼š`content/YYYY/MM/slug.md`
- [ ] frontmatter åŒ…å«ï¼štitleã€dateã€categories
- [ ] åœ–ç‰‡å·²ä¸Šå‚³åˆ° R2ï¼š`r2:blog-post/YYYY/MM/slug/`
- [ ] æ–‡ç« ä¸­åœ–ç‰‡ URL æ ¼å¼ï¼š`https://your-cdn-domain.com/YYYY/MM/slug/image.webp`
- [ ] æœ¬åœ°æ¸¬è©¦ï¼š`npm run dev`
- [ ] ç¢ºèªåœ–ç‰‡å¯æ­£å¸¸è¨ªå•

---

## é€²éšï¼šæ‰¹æ¬¡è™•ç†

å¦‚æœä½ æœ‰å¤šå¼µåœ–ç‰‡éœ€è¦å„ªåŒ–å’Œä¸Šå‚³ï¼š

```bash
# 1. è½‰æ› PNG/JPG ç‚º WebPï¼ˆå¯é¸ï¼Œæ¸›å°æª”æ¡ˆå¤§å°ï¼‰
for img in *.{jpg,png}; do
  cwebp -q 85 "$img" -o "${img%.*}.webp"
done

# 2. æ‰¹æ¬¡ä¸Šå‚³æ‰€æœ‰ WebP
rclone copy . r2:blog-post/2025/11/my-post/ \
  --include "*.webp" \
  --progress

# 3. é©—è­‰
rclone ls r2:blog-post/2025/11/my-post/
```

---

## åƒè€ƒè³‡æº

- [Next.js å®˜æ–¹æ–‡æª”](https://nextjs.org/docs)
- [Cloudflare R2 æ–‡æª”](https://developers.cloudflare.com/r2/)
- [rclone å®˜æ–¹æ–‡æª”](https://rclone.org/docs/)
- [Markdown èªæ³•](https://www.markdownguide.org/)

---

**æ’°å¯«æ„‰å¿«ï¼** ğŸ‰
